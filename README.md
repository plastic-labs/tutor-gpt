# tutor-gpt

Tutor-GPT is a LangChain LLM application. It dynamically reasons about your learning needs and *updates its own prompts* to best serve you.  

We leaned into theory of mind experiments and Bloom is now more than just a literacy tutor, itâ€™s an expansive learning companion. Read more about how it works [here](https://plasticlabs.ai/blog/Theory-of-Mind-is-All-You-Need) or you can join our [Discord](https://discord.gg/bloombotai) to try out our implementation for free (while our OpenAI spend lasts ðŸ˜„).  

Alternatively, you can run your own instance of the bot by following the instructions below.  

## Installation

This project requires docker to be installed and running locally. [Install docker](https://docs.docker.com/get-docker/) and ensure it's running before proceeding.

## Getting Started

This app requires you to have a few different environment variables set. Create a `.env` file from the `.env.template`.

### Step 1: Application configuration

#### Required parameters

1. `OPENAI_API_KEY`: Go to [OpenAI](https://beta.openai.com/account/api-keys) to generate your own API key.  
2. `OPENAI_API_TYPE`: You can select what kind of OpenAI api type you wish to use. Options: `open_ai` (default) or `azure`.
3. `SUPABASE_URL`: You can get this from `Supabase > Settings > API > Project URL`. Your URL will be: `https://<your project reference id>.supabase.co`.
4. `SUPABASE_KEY`: You can get this from `Supabase > Settings > API > Project API Keys > service_role / secret`. Make sure to keep this a secret and don't share it!

#### Optional parameters
1. `BOT_TOKEN`: This is the discord bot token. You can find instructions on how to create a bot and generate a token in the [pycord docs](https://guide.pycord.dev/getting-started/creating-your-first-bot).  
2. `THOUGHT_CHANNEL_ID`: This is the discord channel for the bot to output thoughts to. Make a channel in your server and copy the ID by right clicking the channel and copying the link. The channel ID is the last string of numbers in the link.  

### Step 2: Running on Docker

The repository containers a `Dockerfile` for running the TutorGPT bot in a containerized workflow. Use the following command to build and run the container locally:

```bash
docker build -t tutor-gpt:latest .
docker run -p 8000:8000 --env-file .env tutor-gpt 
```

This builds the docker image, and runs the application using the environment file you've configured. It also makes sure your container's port 8000 is accessible to your host machine. For more details on how networking works between containeres and host machines, read [Docker Networking](https://docs.docker.com/network/).

### Step 3: Configuring Supabase

The next thing you need to do is to configure Supabase so that it has the necessary tables (`memory`, `conversations`) that the application will interact with.

```sql
create table
  public.conversations (
    id bigint generated by default as identity,
    user_id text null,
    location_id text null,
    metadata jsonb null,
    "isActive" boolean null,
    created_at timestamp with time zone not null default now(),
    conversation_id uuid null default gen_random_uuid (),
    constraint conversations_pkey primary key (id)
  ) tablespace pg_default;

create table
  public.memory (
    id bigint generated by default as identity,
    session_id text null,
    user_id text null,
    message_type text null,
    message jsonb null,
    created_at timestamp with time zone not null default now(),
    constraint memory_pkey primary key (id)
  ) tablespace pg_default;
```

### Step 4: New User Initialization

After the tables are configured, create a new row in the `conversations` table and specify a new user.

For example:

```
id=1
user_id=example_user_id
location_id=NULL
metadata=NULL
isActive=true
```

Now the application is ready to start this conversation!

### Step 5a: REST API interface

The primary way you can interact with the TutorGPT service is via REST API requests, which you can do through cURL.

With the TutorGPT service running on docker on your localhost using port 8000, you can use the cURL script below to start a conversation.

```bash
curl --location 'http://localhost:8000/api/chat' \
--header 'Content-Type: application/json' \
--data '{
    "conversation_id": "1",
    "user_id": "example_user_id",
    "message": "Help me focus my marketing research. Our objectives are to penetrate the market and grow our existing customer base. Our product that we want to focus on is the Chipotle Burrito Bowl, and we need a marketing plan for the duration of a year."
}'
```

After you press enter, the application will begin processing, generating its thoughts and response in the `memory` table in Supabase which you can observe. Once it has finished analyzing, it will respond with an HTTP response with TutorGPT's tailored response.

### Step 5b: Alternate user interfaces

The current behaviour will utilize the `.env` file in your local repository and
run the bot. There are two separate entry points for tutor-gpt both a discord UI
and a web UI. Below contains snippets for manually specifying the execution
environment.

```bash
docker run --env-file .env tutor-gpt python -u -m bot.app # Discord UI
docker run -p 8501:8501 --env-file .env tutor-gpt python -u -m streamlit run api/main.py # Web UI
```

### Architecture

Below is high level diagram of the architecture for the bot.
![Tutor-GPT Discord Architecture](assets/ToM&#32;Chain&#32;Flow.png)

## Contributing

This project uses [poetry](https://python-poetry.org/) to manage dependencies.
To install dependencies locally run `poetry install`. Or alternatively run
`poetry shell` to activate the virtual environment

To activate the virtual environment within the same shell you can use the
following one-liner:

```bash
source $(poetry env info --path)/bin/activate
```

On some systems this may not detect the proper virtual environment. You can
diagnose this by running `poetry env info` directly to see if the virtualenv
is defined.

If using `pyenv` remember to set **prefer-active-python** to true. As per
this section of the [documentation](https://python-poetry.org/docs/managing-environments/).

Another workaround that may work if the above setting does not work is to
continue directly with `poetry shell` or wrap the source command like below

```bash
poetry run source $(poetry env info --path)/bin/activate
```
